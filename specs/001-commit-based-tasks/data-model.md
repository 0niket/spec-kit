# Data Model: Diverge-Converge Workflow

**Feature**: 001-commit-based-tasks
**Date**: 2025-12-11

## Entity Overview

```text
┌─────────────────────────────────────────────────────────────────┐
│                        DIVERGENT                                │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐                  │
│  │   Spec   │───>│   Plan   │───>│   Task   │                  │
│  └──────────┘    └──────────┘    └──────────┘                  │
│                                        │                        │
├────────────────────────────────────────┼────────────────────────┤
│                        CONVERGENT      │                        │
│                                        ▼                        │
│                               ┌──────────────┐                  │
│                               │    Commit    │                  │
│                               │  ┌────────┐  │                  │
│                               │  │Rep.Task│  │                  │
│                               │  └────────┘  │                  │
│                               └──────────────┘                  │
│                                        │                        │
│                                        ▼                        │
│                               ┌──────────────┐                  │
│                               │  Milestone   │                  │
│                               │  ┌────────┐  │                  │
│                               │  │Verify  │  │                  │
│                               │  └────────┘  │                  │
│                               └──────────────┘                  │
└─────────────────────────────────────────────────────────────────┘
```

## Entities

### Task

The smallest unit of work, generated by `/speckit.tasks`.

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Unique identifier (e.g., "T001", "T002") |
| `description` | string | What needs to be done |
| `story_ref` | string | Reference to user story (e.g., "US1") |
| `priority` | enum | P1, P2, P3 |
| `phase` | string | Implementation phase (e.g., "Phase 1: Core") |
| `file_path` | string? | Target file path hint (optional) |
| `status` | enum | pending, in_progress, completed, skipped |
| `dependencies` | string[] | List of task IDs this depends on |

**Source**: `tasks.md` (generated by `/speckit.tasks`)

**Example**:

```markdown
- [ ] [T001] [P1] [US1] Create speckit.commits.md slash command `/.claude/commands/speckit.commits.md`
```

### RepetitiveTask

A task derived from constitution that applies to commits based on triggers.

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Template identifier (e.g., "TDD-RED", "LINT-BASH") |
| `name` | string | Human-readable task name |
| `source` | string | Constitution section reference |
| `trigger` | enum | code_change, bash_script, python_code, markdown, all |
| `order` | number | Execution order within commit (lower = earlier) |
| `phase` | string? | TDD phase (RED, GREEN, REFACTOR) if applicable |

**Source**: Constitution parsing (`.specify/memory/constitution.md`)

**Instances** (from current constitution):

| ID | Name | Trigger | Order |
|----|------|---------|-------|
| TDD-RED | Write failing test | code_change | 1 |
| TDD-GREEN | Implement to pass test | code_change | 2 |
| TDD-REFACTOR | Refactor while green | code_change | 3 |
| LINT-BASH | Run shellcheck | bash_script | 90 |
| LINT-PYTHON | Run ruff check | python_code | 90 |
| LINT-MD | Run markdownlint | markdown | 90 |
| VERIFY | Run make check | all | 99 |

### Commit

An accumulation of tasks that forms a single git commit.

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Commit identifier (e.g., "C001") |
| `message` | string | Conventional commit message |
| `type` | enum | feat, fix, test, refactor, docs, chore |
| `scope` | string? | Affected component (optional) |
| `story_ref` | string | Primary user story reference |
| `status` | enum | pending, in_progress, completed, failed |
| `tasks` | Task[] | Non-repetitive tasks in this commit |
| `repetitive_tasks` | RepetitiveTask[] | Constitution-derived tasks |
| `git_sha` | string? | **Runtime only** - populated by `/speckit.implement` after git commit created |

**Source**: `commits.md` (generated by `/speckit.commits`)

**Relationships**:

- Contains 1..n Tasks (non-repetitive)
- Contains 0..n RepetitiveTasks (based on triggers)
- Belongs to 1 Milestone

**Validation Rules**:

1. At least one non-repetitive task required
2. All tasks must have same or compatible story_ref
3. Task dependencies must be satisfiable within commit or prior commits

### Milestone

An accumulation of commits requiring manual verification.

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Milestone identifier (e.g., "M001") |
| `title` | string | User story title or custom name |
| `story_ref` | string | Primary user story reference |
| `priority` | enum | P1, P2, P3 (inherited from story) |
| `status` | enum | pending, verification_required, verified, rejected |
| `commits` | Commit[] | Commits included in this milestone |
| `verification_criteria` | VerificationCriterion[] | What to check |
| `verification_notes` | string? | **Runtime only** - reviewer comments added during verification |
| `verified_at` | datetime? | **Runtime only** - populated when milestone is verified |
| `verified_by` | string? | **Runtime only** - populated when milestone is verified |

**Source**: `milestones.md` (generated by `/speckit.milestones`)

**Relationships**:

- Contains 1..n Commits
- Has 1..n VerificationCriteria

### VerificationCriterion

A specific check to perform at milestone verification.

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Criterion identifier (e.g., "V001") |
| `description` | string | What to verify (from acceptance scenario) |
| `source` | string | "spec" or "manual" |
| `status` | enum | pending, passed, failed |
| `notes` | string? | Verification notes |

**Source**: Acceptance scenarios from `spec.md`

## State Transitions

### Task Status

```text
pending ──> in_progress ──> completed
                │
                └──> skipped (if blocked or not needed)
```

### Commit Status

```text
pending ──> in_progress ──> completed ──> [git commit created]
                │
                └──> failed (tests fail, lint errors)
                        │
                        └──> pending (after fixes)
```

### Milestone Status

```text
pending ──> verification_required ──> verified
                    │
                    └──> rejected ──> pending (rollback)
```

## Relationships Summary

```text
Specification (1) ──contains──> (n) User Stories
User Story (1) ──maps to──> (1..n) Milestones
Milestone (1) ──contains──> (1..n) Commits
Commit (1) ──contains──> (1..n) Tasks
Commit (1) ──contains──> (0..n) Repetitive Tasks
Task (n) ──references──> (1) User Story
Constitution (1) ──defines──> (n) Repetitive Task Templates
```

## File Artifacts

| Entity | File | Generated By |
|--------|------|--------------|
| Task | `tasks.md` | `/speckit.tasks` |
| Commit | `commits.md` | `/speckit.commits` |
| Milestone | `milestones.md` | `/speckit.milestones` |
| RepetitiveTask | (parsed at runtime) | `/speckit.commits` from constitution |
| VerificationCriterion | `milestones.md` | `/speckit.milestones` from spec |
